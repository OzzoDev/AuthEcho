import{u as Y,y as u,z as _,m as $,r as n,g as F,A as J,q as y,j as e,O as V,B as H,i as A,C as Q,E as m,D as W,R as X,J as Z,K as ee,N as te}from"./index-BrTf-wJD.js";import{u as ae}from"./useManageAppStore-BVWuX5fS.js";import{A as se}from"./AppDetailsCard-CtywlhCR.js";import{D as g}from"./Divider-4uKQQNG6.js";import{U as ne}from"./UpdateDataForm-pr8K4dVU.js";import"./AppCardData-djT6c76o.js";function de(){const r=Y(),{fetchData:j}=u("PUT","UPDATEAPP"),{fetchData:D}=u("POST","GENERATEAPKEY"),{fetchData:v}=u("DELETE","DELETEAPP"),{copyToClipboard:T}=_(),{getApp:N,editApp:b,removeApp:w}=ae(),{appname:x}=$(),[s,C]=n.useState(N(x)),{username:f}=F(),[E,P]=n.useState(((s==null?void 0:s.admins)??[]).filter(a=>a!==f)),[c,S]=n.useState(s.resources),[l,k]=n.useState(E),[t,o]=n.useState({app:s.name,appName:s.name,appDescription:s.description,origin:s.origin,admins:s.admins,resources:s.resources,status:s.status,deleteCommand:""}),[d,K]=n.useState(""),[I,h]=n.useState(!1),O=Object.keys(J).map(a=>y(a));n.useEffect(()=>{const a={name:t.appName,origin:t.origin,creator:t.creator||"",admins:t.admins||[],description:t.appDescription,resources:t.resources,status:t.status||"development",users:s.users};b(a),C(a),P(((s==null?void 0:s.admins)??[]).filter(i=>i!==f))},[t]),n.useEffect(()=>{const a=setTimeout(()=>{(async()=>{await j(!1,t)})()},1e3);return()=>clearTimeout(a)},[t]),n.useEffect(()=>{const a={...t,resources:c};o(a)},[c]),n.useEffect(()=>{const a={...t,admins:l};o(a)},[l]);const p=a=>{const{name:i,value:G}=a.target,q={...t,[i]:G};o(q)},U=a=>{const i={...t,status:a};o(i)},R=async()=>{const a=await D(!1,t);if(a){const i=a.data.appKey;i&&K(i),h(!1)}},L=async()=>{await v(!1,t)&&(w(t.appName),r("/account/myapps"))},M=()=>{h(a=>!a),T(d)},z=()=>{r("/account/myapps")},B=()=>{r(`/account/myapps/${x}/traffic`)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-y-2 p-4",children:[e.jsx(V,{btnText:"Go back",onClick:z,icon:e.jsx(H,{size:24})}),e.jsx(A,{btnText:"See traffic",onClick:B,icon:e.jsx(Q,{size:24})})]}),e.jsx(se,{app:s}),e.jsxs("div",{className:"flex flex-col gap-y-[40px] my-[100px] mx-auto w-[90%] md:w-[80%] lg:w-[70%]",children:[e.jsx(m,{labelText:"Name",name:"appName",value:t.appName,placeholder:"My app",maxLength:100,onChange:p,children:e.jsxs("p",{children:["Enter the name of your application.",e.jsx("span",{className:"text-red-400",children:" Maximum 100 characters"}),"."]})}),e.jsx(m,{labelText:"Origin",type:"url",name:"origin",value:t.origin,maxLength:100,onChange:p,children:e.jsxs("p",{children:["Specify the production domain or development URL (e.g., example.com, http://localhost:3001).",e.jsx("span",{className:"text-red-400",children:" Please note that only one application is allowed per origin."})]})}),e.jsx(m,{labelText:"Description",type:"textarea",name:"appDescription",placeholder:"This is my first Authecho app",value:t.appDescription,maxLength:300,isRequired:!1,onChange:p,children:e.jsxs("p",{children:["You may optionally provide a description for your application",e.jsx("span",{className:"text-red-400",children:" of maximum 300 characters"}),". This description may be publicly accessible and serves to clarify the purpose and functionality of your app, thereby assisting users in understanding its features and benefits."]})}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx("p",{className:"text-cyan-200",children:"Status"}),e.jsx(W,{initialValue:y(t.status||""),items:O,onSelect:U}),e.jsx("p",{className:"text-gray-400",children:"Update the status of the application to accurately reflect its operational state, such as whether it is currently running in the development or production environment"})]}),e.jsx(X,{resources:c,setResources:S}),e.jsx(Z,{admins:l,setAdmins:k})]}),e.jsx(g,{dividerText:"Advanced settings",color:"darkcyan"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-8 w-full py-[40px]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center gap-x-10 gap-y-6",children:[e.jsx(A,{btnText:"Get new API key",onClick:R,icon:e.jsx(ee,{},24)}),d&&e.jsxs("div",{className:"flex flex gap-x-10 items-center w-fit",children:[e.jsx(te,{text:d}),e.jsx("button",{onClick:M,children:I?"Copied":"Copy"})]})]}),e.jsx("p",{className:"w-[90%] max-w-[600px]",children:"If you have lost access to your application’s API key, you can obtain a new one here. Please note that this key is displayed only once for security purposes. It is strongly recommend that you store it in a secure location for future reference."})]}),e.jsx(g,{dividerText:"Danger zone"}),e.jsx("div",{className:"flex flex-col items-center w-full py-[40px]",children:e.jsx(ne,{label:"Delete app",name:"deleteCommand",value:t.deleteCommand||"",placeholder:`delete ${t.appName}`,isDangerous:!0,btnText:"Delete",onChange:p,onSubmit:L,children:e.jsxs("p",{className:"mt-4",children:["Please proceed with caution. If you choose to delete an application, there will be no way to restore it. To delete it anyway, please type",e.jsxs("span",{className:"text-red-400",children:[" delete ",t.appName]})," and then click the delete button."]})})})]})}export{de as default};
