import{u as S,h,a as v,j as e,i as w,k as y,l as P,m as V,r as d,n as j,s as O,H as T,o as U}from"./index-DEzWTRxo.js";import{A as m}from"./AppCardData-DmQLLLlm.js";import{S as _}from"./SearchBarFlat-BDv09xq6.js";import{P as D}from"./Paginator-Dmv7KVP7.js";import"./clsx-B-dksMZM.js";function M({invoice:i}){const p=S(),{callApi:x}=h("GET","ACCOUNTOVERVIEW"),{callApi:n}=h("PUT","READINVOICE"),{updateUnReadInvoices:u}=v(),f=async()=>{if(await n(!1,{invoiceID:i._id})){const r=await x(),o=r==null?void 0:r.data.unReadInvoices;o!==void 0&&u(o),p(`${encodeURIComponent(i._id)}`)}};return e.jsxs("div",{className:"flex items-center justify-between w-full p-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-1 w-full",children:[e.jsx(m,{desciption:"Subject",data:i.subject}),e.jsx(m,{desciption:"From",data:i.from}),e.jsx(m,{desciption:"Sent at",data:i.sentAt})]}),e.jsx(w,{btnText:"Read",onClick:f,icon:i.isRead?e.jsx(y,{}):e.jsx(P,{})})]})}function L(){const{invoiceid:i}=V(),{updateInvoices:p}=v(),{callApi:x}=h("GET","GETINVOICES"),[n,u]=d.useState([]),[f,c]=d.useState({current:1,latest:1,pageCount:1}),[r,o]=d.useState("idle");d.useEffect(()=>{(async()=>{o("loading");const s=await x(),t=s==null?void 0:s.data.invoices;if(t){const a=[...t].map(l=>({...l,isVisible:!0})).sort((l,E)=>{const g=l.isRead,N=E.isRead;return g===N?0:g?1:-1});u(a),p(a),c(l=>({...l,pageCount:j(a,4)})),o("success")}else o("error")})()},[]),d.useEffect(()=>{const s=[...n].filter(t=>t.isVisible);c(t=>({...t,pageCount:j(s,4)}))},[n]);const I=s=>{const t=[...n].map(a=>({...a,isVisible:a.subject.toLowerCase().includes(s)}));u(t),c(s?a=>({...a,current:1}):a=>({...a,current:a.latest}))},C=(s,t)=>{c(a=>({...a,current:t,latest:t}))},b=[...n].filter((s,t)=>O(t,f.current,4)).filter(s=>s.isVisible),A=n.length>4,R=![...n].some(s=>s.isVisible);return r==="loading"?e.jsx(T,{size:50,color:"white",className:"m-auto"}):n.length===0?e.jsx("h2",{className:"text-2xl font-semibold text-cyan-300 ml-[20px] pt-[30px] pb-[60px]",children:"You currently have no invoices"}):i?e.jsx(U,{}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"p-2 mb-10",children:e.jsx(_,{onChange:I})}),R?e.jsx("h2",{className:"text-xl font-semibold text-red-400 p-8",children:"You do not have any invoices that match the search query."}):e.jsxs(e.Fragment,{children:[A&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(D,{onChange:C,count:f.pageCount})}),e.jsx("ul",{className:"flex flex-col gap-y-10 w-full",children:b.map(s=>e.jsx(M,{invoice:s},s._id))})]})]})}export{L as default};
